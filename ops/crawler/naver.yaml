#---
#apiVersion: v1
#kind: Service
#metadata:
#  name: naver-mq
#  labels:
#    app: naver-mq
#spec:
#  type: ClusterIP
#  clusterIP: None
#  selector:
#    app: naver-mq
#  ports:
#    - port: 5672
#      targetPort: 5672
#
#---
#apiVersion: apps/v1
#kind: Deployment
#metadata:
#  name: naver-mq
#  labels:
#    app: naver-mq
#spec:
#  selector:
#    matchLabels:
#      app: naver-mq
#  replicas: 1
#  template:
#    metadata:
#      labels:
#        app: naver-mq
#    spec:
#      restartPolicy: Always
#      imagePullSecrets:
#        - name: registry
#      containers:
#        - name: default
#          image: registry.nlp-utils/rabbitmq:3-management
#          imagePullPolicy: Always
#          ports:
#            - containerPort: 5672
#          env:
#            - name: RABBITMQ_DEFAULT_PASS
#              value: nlplab!
#            - name: RABBITMQ_DEFAULT_USER
#              value: user
#
#---
#apiVersion: apps/v1
#kind: Deployment
#metadata:
#  name: naver-pipeline
#  labels:
#    app: pipeline
#spec:
#  selector:
#    matchLabels:
#      app: pipeline
#  replicas: 1
#  template:
#    metadata:
#      labels:
#        app: pipeline
#    spec:
#      restartPolicy: Always
#      hostAliases:
#        - ip: "172.20.93.112"
#          hostnames:
#            - "corpus.ncsoft.com"
#      imagePullSecrets:
#        - name: registry
#      containers:
#        - name: default
#          image: registry.nlp-utils/crawler/corpus_pipeline:latest
#          imagePullPolicy: Always
#          env:
#            - name: CONSUMER_EXCHANGE_NAME
#              value: corpus_pipeline
#            - name: CONSUMER_HOST
#              value: naver-mq.crawler.svc.cluster.local
#            - name: CONSUMER_PORT
#              value: "5672"
#            - name: CONSUMER_USER_NAME
#              value: user
#            - name: CONSUMER_USER_PASSWD
#              value: nlplab!
#            - name: ELASTIC_HOST
#              value: https://corpus.ncsoft.com:9200
#            - name: NLU_WRAPPER_URL
#              value: http://nluwrapper.crawler.svc.cluster.local/
#            - name: USE_CONSUMER
#              value: "1"

---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: naver-economy
  labels:
    app: crawler-naver-news
spec:
  schedule: "0,30 * * * *"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          hostAliases:
            - ip: "172.20.93.112"
              hostnames:
                - "corpus.ncsoft.com"
          imagePullSecrets:
            - name: registry
          containers:
            - name: default
              image: registry.nlp-utils/crawler:latest
              imagePullPolicy: Always
              resources:
                requests:
                  cpu: 100m
                  memory: 100Mi
                limits:
                  cpu: 200m
                  memory: 200Mi
              env:
                - name: ELASTIC_SEARCH_INDEX
                  value: $(INDEX_ECONOMY)
                - name: ELASTIC_SEARCH_AUTH
                  valueFrom:
                    secretKeyRef:
                      name: elasticsearch-auth
                      key: http_auth
              envFrom:
                - configMapRef:
                    name: naver
              args: [
                "python3", "batch.py",
                "--skip_post_process",
                "--category", "naver",
                "--job_id", "economy"
              ]

---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: naver-international
  labels:
    app: crawler-naver-news
spec:
  schedule: "5,35 * * * *"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          hostAliases:
            - ip: "172.20.93.112"
              hostnames:
                - "corpus.ncsoft.com"
          imagePullSecrets:
            - name: registry
          containers:
            - name: default
              image: registry.nlp-utils/crawler:latest
              imagePullPolicy: Always
              resources:
                requests:
                  cpu: 100m
                  memory: 100Mi
                limits:
                  cpu: 200m
                  memory: 200Mi
              env:
                - name: ELASTIC_SEARCH_INDEX
                  value: $(INDEX_INTERNATIONAL)
                - name: ELASTIC_SEARCH_AUTH
                  valueFrom:
                    secretKeyRef:
                      name: elasticsearch-auth
                      key: http_auth
              envFrom:
                - configMapRef:
                    name: naver
              args: [
                "python3", "batch.py",
                "--skip_post_process",
                "--category", "naver",
                "--job_id", "international"
              ]

---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: naver-it
  labels:
    app: crawler-naver-news
spec:
  schedule: "10,40 * * * *"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          hostAliases:
            - ip: "172.20.93.112"
              hostnames:
                - "corpus.ncsoft.com"
          imagePullSecrets:
            - name: registry
          containers:
            - name: default
              image: registry.nlp-utils/crawler:latest
              imagePullPolicy: Always
              resources:
                requests:
                  cpu: 100m
                  memory: 100Mi
                limits:
                  cpu: 200m
                  memory: 200Mi
              env:
                - name: ELASTIC_SEARCH_INDEX
                  value: $(INDEX_IT)
                - name: ELASTIC_SEARCH_AUTH
                  valueFrom:
                    secretKeyRef:
                      name: elasticsearch-auth
                      key: http_auth
              envFrom:
                - configMapRef:
                    name: naver
              args: [
                "python3", "batch.py",
                "--skip_post_process",
                "--category", "naver",
                "--job_id", "it"
              ]

---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: naver-living
  labels:
    app: crawler-naver-news
spec:
  schedule: "15,45 * * * *"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          hostAliases:
            - ip: "172.20.93.112"
              hostnames:
                - "corpus.ncsoft.com"
          imagePullSecrets:
            - name: registry
          containers:
            - name: default
              image: registry.nlp-utils/crawler:latest
              imagePullPolicy: Always
              resources:
                requests:
                  cpu: 100m
                  memory: 100Mi
                limits:
                  cpu: 200m
                  memory: 200Mi
              env:
                - name: ELASTIC_SEARCH_INDEX
                  value: $(INDEX_LIVING)
                - name: ELASTIC_SEARCH_AUTH
                  valueFrom:
                    secretKeyRef:
                      name: elasticsearch-auth
                      key: http_auth
              envFrom:
                - configMapRef:
                    name: naver
              args: [
                "python3", "batch.py",
                "--skip_post_process",
                "--category", "naver",
                "--job_id", "living"
              ]

---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: naver-opinion
  labels:
    app: crawler-naver-news
spec:
  schedule: "20,50 * * * *"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          hostAliases:
            - ip: "172.20.93.112"
              hostnames:
                - "corpus.ncsoft.com"
          imagePullSecrets:
            - name: registry
          containers:
            - name: default
              image: registry.nlp-utils/crawler:latest
              imagePullPolicy: Always
              resources:
                requests:
                  cpu: 100m
                  memory: 100Mi
                limits:
                  cpu: 200m
                  memory: 200Mi
              env:
                - name: ELASTIC_SEARCH_INDEX
                  value: $(INDEX_OPINION)
                - name: ELASTIC_SEARCH_AUTH
                  valueFrom:
                    secretKeyRef:
                      name: elasticsearch-auth
                      key: http_auth
              envFrom:
                - configMapRef:
                    name: naver
              args: [
                "python3", "batch.py",
                "--skip_post_process",
                "--category", "naver",
                "--job_id", "opinion"
              ]

---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: naver-politics
  labels:
    app: crawler-naver-news
spec:
  schedule: "25,55 * * * *"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          hostAliases:
            - ip: "172.20.93.112"
              hostnames:
                - "corpus.ncsoft.com"
          imagePullSecrets:
            - name: registry
          containers:
            - name: default
              image: registry.nlp-utils/crawler:latest
              imagePullPolicy: Always
              resources:
                requests:
                  cpu: 100m
                  memory: 100Mi
                limits:
                  cpu: 200m
                  memory: 200Mi
              env:
                - name: ELASTIC_SEARCH_INDEX
                  value: $(INDEX_POLITICS)
                - name: ELASTIC_SEARCH_AUTH
                  valueFrom:
                    secretKeyRef:
                      name: elasticsearch-auth
                      key: http_auth
              envFrom:
                - configMapRef:
                    name: naver
              args: [
                "python3", "batch.py",
                "--skip_post_process",
                "--category", "naver",
                "--job_id", "politics"
              ]

---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: naver-society
  labels:
    app: crawler-naver-news
spec:
  schedule: "0,30 * * * *"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          hostAliases:
            - ip: "172.20.93.112"
              hostnames:
                - "corpus.ncsoft.com"
          imagePullSecrets:
            - name: registry
          containers:
            - name: default
              image: registry.nlp-utils/crawler:latest
              imagePullPolicy: Always
              resources:
                requests:
                  cpu: 100m
                  memory: 100Mi
                limits:
                  cpu: 200m
                  memory: 200Mi
              env:
                - name: ELASTIC_SEARCH_INDEX
                  value: $(INDEX_SOCIETY)
                - name: ELASTIC_SEARCH_AUTH
                  valueFrom:
                    secretKeyRef:
                      name: elasticsearch-auth
                      key: http_auth
              envFrom:
                - configMapRef:
                    name: naver
              args: [
                "python3", "batch.py",
                "--skip_post_process",
                "--category", "naver",
                "--job_id", "society"
              ]

---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: naver-sports
  labels:
    app: crawler-naver-news
spec:
  schedule: "5,35 * * * *"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          hostAliases:
            - ip: "172.20.93.112"
              hostnames:
                - "corpus.ncsoft.com"
          imagePullSecrets:
            - name: registry
          containers:
            - name: default
              image: registry.nlp-utils/crawler:latest
              imagePullPolicy: Always
              resources:
                requests:
                  cpu: 100m
                  memory: 100Mi
                limits:
                  cpu: 200m
                  memory: 200Mi
              env:
                - name: ELASTIC_SEARCH_INDEX
                  value: $(INDEX_SPORTS)
                - name: ELASTIC_SEARCH_AUTH
                  valueFrom:
                    secretKeyRef:
                      name: elasticsearch-auth
                      key: http_auth
              envFrom:
                - configMapRef:
                    name: naver
              args: [
                "python3", "batch.py",
                "--skip_post_process",
                "--category", "naver",
                "--job_id", "sports"
              ]

---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: naver-tv
  labels:
    app: crawler-naver-news
spec:
  schedule: "10,40 * * * *"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          hostAliases:
            - ip: "172.20.93.112"
              hostnames:
                - "corpus.ncsoft.com"
          imagePullSecrets:
            - name: registry
          containers:
            - name: default
              image: registry.nlp-utils/crawler:latest
              imagePullPolicy: Always
              resources:
                requests:
                  cpu: 100m
                  memory: 100Mi
                limits:
                  cpu: 200m
                  memory: 200Mi
              env:
                - name: ELASTIC_SEARCH_INDEX
                  value: $(INDEX_TV)
                - name: ELASTIC_SEARCH_AUTH
                  valueFrom:
                    secretKeyRef:
                      name: elasticsearch-auth
                      key: http_auth
              envFrom:
                - configMapRef:
                    name: naver
              args: [
                "python3", "batch.py",
                "--skip_post_process",
                "--category", "naver",
                "--job_id", "tv"
              ]
