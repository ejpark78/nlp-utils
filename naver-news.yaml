---
jobs:
  - name: economy
    index: crawler-naver-economy-{year}
    article:
      document_id:
        frame: '{oid}-{aid}'
        type: query
    list:
      - category: 경제/증권
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=101&sid2=258&listType=title&date={date}&page={page}
      - category: 경제/금융
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=101&sid2=259&listType=title&date={date}&page={page}
      - category: 경제/부동산
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=101&sid2=260&listType=title&date={date}&page={page}
      - category: 경제/산업/재계
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=101&sid2=261&listType=title&date={date}&page={page}
      - category: 경제/글로벌 경제
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=101&sid2=262&listType=title&date={date}&page={page}
      - category: 경제/경제 일반
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=101&sid2=263&listType=title&date={date}&page={page}
      - category: 경제/생활경제
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=101&sid2=310&listType=title&date={date}&page={page}
      - category: 경제/중기/벤처
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=101&sid2=771&listType=title&date={date}&page={page}

  - name: international
    index: crawler-naver-international-{year}
    article:
      document_id:
        frame: '{oid}-{aid}'
        type: query
    list:
      - category: 세계/아시아호주
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=104&sid2=231&listType=title&date={date}&page={page}
      - category: 세계/미국중남미
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=104&sid2=232&listType=title&date={date}&page={page}
      - category: 세계/유럽
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=104&sid2=233&listType=title&date={date}&page={page}
      - category: 세계/중동아프리카
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=104&sid2=234&listType=title&date={date}&page={page}
      - category: 세계/일반
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=104&sid2=322&listType=title&date={date}&page={page}

  - name: it
    index: crawler-naver-it-{year}
    article:
      document_id:
        frame: '{oid}-{aid}'
        type: query
    list:
      - category: IT/모바일
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=105&sid2=731&listType=title&date={date}&page={page}
      - category: IT/인터넷/SNS
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=105&sid2=226&listType=title&date={date}&page={page}
      - category: IT/통신/뉴미디어
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=105&sid2=227&listType=title&date={date}&page={page}
      - category: IT/IT 일반
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=105&sid2=230&listType=title&date={date}&page={page}
      - category: IT/보안/해킹
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=105&sid2=732&listType=title&date={date}&page={page}
      - category: IT/컴퓨터
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=105&sid2=283&listType=title&date={date}&page={page}
      - category: IT/게임/리뷰
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=105&sid2=229&listType=title&date={date}&page={page}
      - category: IT/과학 일반
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=105&sid2=228&listType=title&date={date}&page={page}

  - name: living
    index: crawler-naver-living-{year}
    article:
      document_id:
        frame: '{oid}-{aid}'
        type: query
    list:
      - category: 생활/건강정보
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=241&listType=title&date={date}&page={page}
      - category: 생활/자동차시승기
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=239&listType=title&date={date}&page={page}
      - category: 생활/도로교통
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=240&listType=title&date={date}&page={page}
      - category: 생활/여행/레저
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=237&listType=title&date={date}&page={page}
      - category: 생활/음식맛집
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=238&listType=title&date={date}&page={page}
      - category: 생활/패션뷰티
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=376&listType=title&date={date}&page={page}
      - category: 생활/공연전시
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=242&listType=title&date={date}&page={page}
      - category: 생활/책
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=243&listType=title&date={date}&page={page}
      - category: 생활/종교
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=244&listType=title&date={date}&page={page}
      - category: 생활/날씨
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=248&listType=title&date={date}&page={page}
      - category: 생활/일반
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=103&sid2=245&listType=title&date={date}&page={page}

  - name: opinion
    index: crawler-naver-opinion-{year}
    article:
      document_id:
        frame: '{oid}-{aid}'
        type: query
    list:
      - category: 오피니언
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?sid1=110&listType=title&mid=shm&date={date}&page={page}

  - name: politics
    index: crawler-naver-politics-{year}
    article:
      document_id:
        frame: '{oid}-{aid}'
        type: query
    list:
      - category: 정치/청와대
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=100&sid2=264&listType=title&date={date}&page={page}
      - category: 정치/국회정당
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=100&sid2=265&listType=title&date={date}&page={page}
      - category: 정치/북한
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=100&sid2=268&listType=title&date={date}&page={page}
      - category: 정치/행정
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=100&sid2=266&listType=title&date={date}&page={page}
      - category: 정치/국방외교
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=100&sid2=267&listType=title&date={date}&page={page}
      - category: 정치/정치일반
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=100&sid2=269&listType=title&date={date}&page={page}

  - name: society
    index: crawler-naver-society-{year}
    article:
      document_id:
        frame: '{oid}-{aid}'
        type: query
    list:
      - category: 사회/사건사고
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=102&sid2=249&listType=title&date={date}&page={page}
      - category: 사회/교육
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=102&sid2=250&listType=title&date={date}&page={page}
      - category: 사회/노동
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=102&sid2=251&listType=title&date={date}&page={page}
      - category: 사회/언론
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=102&sid2=254&listType=title&date={date}&page={page}
      - category: 사회/환경
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=102&sid2=252&listType=title&date={date}&page={page}
      - category: 사회/인권복지
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=102&sid2=59b&listType=title&date={date}&page={page}
      - category: 사회/식품의료
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=102&sid2=255&listType=title&date={date}&page={page}
      - category: 사회/지역
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=102&sid2=256&listType=title&date={date}&page={page}
      - category: 사회/인물
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=102&sid2=276&listType=title&date={date}&page={page}
      - category: 사회/사회일반
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?mode=LS2D&mid=shm&sid1=102&sid2=257&listType=title&date={date}&page={page}

  - name: tv
    index: crawler-naver-tv-{year}
    article:
      document_id:
        frame: '{oid}-{aid}'
        type: query
    list:
      - category: TV
        date_format: '%Y%m%d'
        url_frame: https://news.naver.com/main/list.nhn?sid1=115&listType=title&mid=shm&date={date}&page={page}

#  - name: weather
#    index: crawler-naver-weather-{year}
#    article:
#      document_id:
#        frame: '{oid}-{aid}'
#        type: query
#    list:
#      - category: 날씨
#        date_format: '%Y%m%d'
#        url_frame: https://weather.naver.com/news/wetrNewsList.nhn?ymd={date}

# crawling 과정에서 추출하는 정보
parsing:
  version: v2021-03-29
  parser: html5lib

  # 전체 html 에서 추출해야하는 전체 tag 목록
  trace:
    - select: 'div.list_body.newsflash_body li'

  # 기사 목록에서 추출해야하는 하나의 기사 정보
  list:
    - key: raw_list
      value: [ ]
      type: html
    - key: title
      value:
        - select: 'a'
      type: text
    - key: url
      value:
        - select: 'a'
      type: href
    - key: date
      value:
        - select: 'span.date'
      type: text
      convert:
        to: date
        merge: single
      replace:
        - from: '오전(.+)$'
          to: '\g<1> AM'
        - from: '오후(.+)$'
          to: '\g<1> PM'
    - key: '@curl_list'
      value:
        - const: DATE_NOW

  # 기사 본문에서 추출해야하는 tag 정보
  article:
    - key: raw
      value: [ ]
      type: html
      remove:
        - name: script
        - name: style
        - name: comment
    - key: title
      value:
        - select: 'div.article_info h3#articleTitle'
      type: text
    - key: date
      value:
        - select: 'div.article_info span.t11'
      type: text
      convert:
        to: date
        merge: single
    - key: contents
      value:
        - select: 'div#articleBodyContents'
      type: text
    - key: '@curl_date'
      value:
        - const: 'DATE_NOW'
    # tv 섹션
    - key: date
      replace:
        - from: '오전(.+)$'
          to: '\g<1> AM'
        - from: '오후(.+)$'
          to: '\g<1> PM'
      value:
        - select: 'div.article_info em'
      type: text
      convert:
        to: date
        merge: single
    # weather 섹션
#    - key: date
#      replace:
#        - from: '^.+([0-9]{4,4})[.]([0-9]+)[.]([0-9]+)[.] ([0-9]+):([0-9]+):([0-9]+)'
#          to: '\g<1>-\g<2>-\g<3> \g<4>:\g<5>:\g<6>'
#      value: [ ]
#      type: text
#      convert:
#        to: date
#        merge: single

# ETL pipeline: raw, raw_list 에서 추출하는 정보
pipeline:
  common:
    - column: raw_list
      key: source
      value:
        - select: 'span.writing'
      type: text
    - column: raw
      key: source_section
      value:
        - select: 'div.guide_categorization em.guide_categorization_item'
      type: text
    - column: raw
      key: paper
      value:
        - select: 'div.article_info span.sponsor_newspaper'
      type: text
      remove:
        - select: 'i.picon'
    - column: raw
      key: source_url
      value:
        - select: 'div.sponsor a'
      type: href
      convert:
        merge: single
    - column: raw
      key: image_list.image
      value:
        - select: 'span.end_photo_org img'
      type: src
    - column: raw
      key: image_list.caption
      value:
        - select: 'span.end_photo_org em.img_desc'
      type: text
      delete: true
    - column: raw
      key: vod
      value:
        - select: 'div#articleBodyContents iframe'
      type: html

  # 생활 섹션
  living:
    # 스포츠 동아
    - column: raw
      key: title
      value:
        - select: 'div.end_ct_area h2.end_tit'
      type: text
    - column: raw
      key: date
      value:
        - select: 'span.author em'
      type: text
      convert:
        to: date
        merge: single
    - column: raw
      key: source_url
      value:
        - select: 'div.article_info a.btn_news_origin'
      type: href
      convert:
        merge: single
    - column: raw
      key: content
      value:
        - select: div#articeBody
      type: text
    # 국민일보
    - column: raw
      key: date
      value:
        - select: 'div.article_info span.t11'
      type: text
      convert:
        to: date
        merge: single

# 인덱스 맵핑
index_mapping:
  settings:
    number_of_replicas: 1
    number_of_shards: 1
  mappings:
    properties:
      title:
        type: text
      url:
        ignore_above: 256
        type: keyword
      contents:
        type: text
      date:
        type: date
      category:
        ignore_above: 50
        type: keyword
      raw:
        enabled: false
      raw_list:
        enabled: false
      parser_version:
        ignore_above: 50
        type: keyword
      status:
        # raw_list, raw, pipeline
        ignore_above: 50
        type: keyword
      '@curl_list':
        type: date
      '@curl_date':
        type: date
