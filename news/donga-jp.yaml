---
jobs:
  - index: raw-donga-jp-{year}
    article:
      document_id:
        replace:
          - from: /news/
            to: '/'
          - from: /article/
            to: '/'
          - from: /all/
            to: '/'
          - from: /home/
            to: '/'
          - from: /en/
            to: '/'
          - from: /cn/
            to: '/'
          - from: /jp/
            to: '/'
          - from: ^/
            to: ''
          - from: /
            to: '-'
        type: path
    args:
      page_range: "1~2000"
      page_step: "20"
    list:
      - category: Business
        url_frame: https://www.donga.com/jp/List?p0=j&p={page}&l=20&c=02
      - category: National
        url_frame: https://www.donga.com/jp/List?p0=j&p={page}&l=20&c=04
      - category: Politics
        url_frame: https://www.donga.com/jp/List?p0=j&p={page}&l=20&c=01
      - category: International
        url_frame: https://www.donga.com/jp/List?p0=j&p={page}&l=20&c=03
      - category: Sports
        url_frame: https://www.donga.com/jp/List?p0=j&p={page}&l=20&c=06
      - category: Culture
        url_frame: https://www.donga.com/jp/List?p0=j&p={page}&l=20&c=08
      - category: Editorial
        url_frame: https://www.donga.com/jp/List?p0=j&p={page}&l=20&c=0501
      - category: Op-ed
        url_frame: https://www.donga.com/jp/List?p0=j&p={page}&l=20&c=0502

# crawling 과정에서 추출하는 정보
parsing:
  version: v2021-03-17
  parser: lxml

  # 전체 html 에서 추출해야하는 전체 tag 목록
  trace:
    - select: li

  # 기사 목록에서 추출해야하는 하나의 기사 정보
  list:
    - key: title
      value:
        - select: span.title
      type: text
    - key: url
      value:
        - select: span.title a
      type: href
    - key: date
      value:
        - select: span.date
      type: text
      type_convert: date
      value_type: single
    - key: '@curl_date'
      value:
        - const: DATE_NOW
      type: text
      type_convert: date

  # 기사 본문에서 추출해야하는 tag 정보
  article:
    - key: raw
      value:
        - name: html
      remove:
        - name: script
        - name: style
        - name: comment
      type: html
    - key: title
      value:
        - select: div#view_title h1
      type: text
    - key: date
      value:
        - select: div#view_title p.date
      replace:
        - from: Posted[ ]*|Updated[ ]*
          to: ''
      type: text
      type_convert: date
      value_type: single
    - key: content
      value:
        - select: div#view_contents
      type: text
    - key: '@curl_date'
      value:
        - const: DATE_NOW
      type: text
      type_convert: date

# ETL pipeline: raw, raw_list 에서 추출하는 정보
pipeline:
  common:
    - column: raw
      key: source_ko
      value:
        - select: div.etc a.ko
      type: href
      value_type: single
