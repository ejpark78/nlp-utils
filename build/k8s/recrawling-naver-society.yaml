---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: elasticsearch-auth
  namespace: crawler-recrawling
data:
  http_auth: Y3Jhd2xlcjpjcmF3bGVyMjAxOQ==

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: naver
  namespace: crawler-recrawling
data:
  ELASTIC_SEARCH_HOST: "https://corpus.ncsoft.com:9200"
  INDEX_SOCIETY: "crawler-naver-society"

---
apiVersion: v1
kind: Pod
metadata:
  name: naver-society
  namespace: crawler-recrawling
  labels:
    app: crawler
spec:
  restartPolicy: Never
  nodeSelector:
    group: "crawler"
  containers:
    - name: default
      image: corpus:5000/crawler:latest
      imagePullPolicy: Always
      resources:
        requests:
          cpu: 100m
          memory: 100Mi
        limits:
          cpu: 200m
          memory: 200Mi
      workingDir: /usr/local/app
      env:
        - name: ELASTIC_SEARCH_INDEX
          value: $(INDEX_SOCIETY)
        - name: ELASTIC_SEARCH_AUTH
          valueFrom:
            secretKeyRef:
              name: elasticsearch-auth
              key: http_auth
      envFrom:
        - configMapRef:
            name: naver
      args: [
        "python3", "batch.py",
        "--overwrite",
        "--skip_post_process",
        "--category", "naver",
        "--job_id", "society",
        "--date_range", "2020-05-18~2020-06-20"
      ]
