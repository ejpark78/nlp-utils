version: '2'

services:

  naver_reply_2019_07:
    image: corpus:5000/crawler:latest
    restart: "no"
    working_dir: /usr/local/app
    command: python3 batch.py -category naver -job_id sports-reply -date_range 2019-07-27~2019-08-01
    extra_hosts:
      - corpus.ncsoft.com:172.20.93.112
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro

  naver_reply_2018_06:
    image: corpus:5000/crawler:latest
    restart: "no"
    working_dir: /usr/local/app
    command: python3 batch.py -category naver -job_id sports-reply -date_range 2018-06-01~2018-06-30
    extra_hosts:
      - corpus.ncsoft.com:172.20.93.112
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro

  naver_reply_2018_07:
    image: corpus:5000/crawler:latest
    restart: "no"
    working_dir: /usr/local/app
    command: python3 batch.py -category naver -job_id sports-reply -date_range 2018-07-01~2018-07-31
    extra_hosts:
      - corpus.ncsoft.com:172.20.93.112
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro

  naver_reply_2018_08:
    image: corpus:5000/crawler:latest
    restart: "no"
    working_dir: /usr/local/app
    command: python3 batch.py -category naver -job_id sports-reply -date_range 2018-08-01~2018-08-18
    extra_hosts:
      - corpus.ncsoft.com:172.20.93.112
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro

  naver_reply_2018_09:
    image: corpus:5000/crawler:latest
    restart: "no"
    working_dir: /usr/local/app
    command: python3 batch.py -category naver -job_id sports-reply -date_range 2018-09-01~2018-09-15
    extra_hosts:
      - corpus.ncsoft.com:172.20.93.112
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro

  naver_reply_2018_10:
    image: corpus:5000/crawler:latest
    restart: "no"
    working_dir: /usr/local/app
    command: python3 batch.py -category naver -job_id sports-reply -date_range 2018-10-01~2018-10-29
    extra_hosts:
      - corpus.ncsoft.com:172.20.93.112
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro

# python3 batch.py -category bbs -job_id mlbpark-bullpen
# make naver-kin-start naver-kin-logs
      
#python3 batch.py -category naver -job_id sports -date_range 2018-01-01~2019-07-01 -date_step=-1

  naver_sports_2018_01:
    image: corpus:5000/crawler:latest
    restart: "no"
    working_dir: /usr/local/app
    command: python3 batch.py -category naver -job_id sports -date_range 2018-01-01~2018-06-30 -date_step=-1
    links:
      - "mq:mq_server"
    depends_on:
      - mq
    extra_hosts:
      - corpus.ncsoft.com:172.20.93.112
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro

  naver_sports_2018_07:
    image: corpus:5000/crawler:latest
    restart: "no"
    working_dir: /usr/local/app
    command: python3 batch.py -category naver -job_id sports -date_range 2018-07-01~2018-11-03 -date_step=-1
    links:
      - "mq:mq_server"
    depends_on:
      - mq
    extra_hosts:
      - corpus.ncsoft.com:172.20.93.112
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro

  mq:
    image: rabbitmq:3-management
    restart: always
    hostname: mq_server
    environment:
      - "RABBITMQ_DEFAULT_USER=user"
      - "RABBITMQ_DEFAULT_PASS=nlplab!"
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro

  corpus-processor:
    image: corpus:5000/crawler/corpus_processor:latest
    restart: always
    mem_limit: 1G
    links:
      - "mq:mq_server"
    depends_on:
      - mq
    environment:
      - "ELASTIC_HOST=corpus.ncsoft.com:172.20.93.112"
      - "KMAT_RSC=/www-data/dictionary/rsc"
      - "NAME_ENTITY_TAGGER_V2=/usr/local/app/nlu_utils/nc_utils/ne_tagger_v2/rsc/ner_rule"
      - "USE_POST_MQ=0"
      - "USE_CONSUMER=1"
      - "CONSUMER_EXCHANGE_NAME=crawler.naver"
      - "CONSUMER_HOST=mq_server"
      - "CONSUMER_USER_NAME=user"
      - "CONSUMER_USER_PASSWD=nlplab!"
    extra_hosts:
      - corpus.ncsoft.com:172.20.93.112
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro

# docker-compose -p naver-reply -f naver-reply.yml up -d
# docker-compose -p naver-reply -f naver-reply.yml logs -f
# docker-compose -p naver-reply -f naver-reply.yml down
