---
jobs:
  - name: sports
    index: crawler-daum-sports-{year}
    article:
      document_id:
        replace:
          - from: /v/
            to: ''
        type: path
    list:
      - category: 스포츠/야구
        date_format: '%Y%m%d'
        url_frame: https://sports.daum.net/api/dapi/harmony/contents.json?page={page}&consumerType=HARMONY&status=SERVICE&createDt={date}000000~{date}235959&size=20
        headers:
          Content-Type: application/json
      - category: 스포츠/해외야구
        date_format: '%Y%m%d'
        url_frame: https://sports.daum.net/sports/api/news/list.jsonp?cateIds=1015&pageSize=20&pageNumber={page}&date={date}
        headers:
          Content-Type: application/json
      - category: 스포츠/게임
        date_format: '%Y%m%d'
        url_frame: https://sports.daum.net/sports/api/news/list.jsonp?cateIds=1079&pageSize=20&pageNumber={page}&date={date}
        headers:
          Content-Type: application/json
      - category: 스포츠/축구
        date_format: '%Y%m%d'
        url_frame: https://sports.daum.net/sports/api/news/list.jsonp?cateIds=1027&pageSize=20&pageNumber={page}&date={date}
        headers:
          Content-Type: application/json
      - category: 스포츠/해외축구
        date_format: '%Y%m%d'
        url_frame: https://sports.daum.net/sports/api/news/list.jsonp?cateIds=100032&pageSize=20&pageNumber={page}&date={date}
        headers:
          Content-Type: application/json
      - category: 스포츠/골프
        date_format: '%Y%m%d'
        url_frame: https://sports.daum.net/sports/api/news/list.jsonp?cateIds=5000&pageSize=20&pageNumber={page}&date={date}
        headers:
          Content-Type: application/json
      - category: 스포츠/농구&배구
        date_format: '%Y%m%d'
        url_frame: https://sports.daum.net/sports/api/news/list.jsonp?cateIds=1029&pageSize=20&pageNumber={page}&date={date}
        headers:
          Content-Type: application/json
      - category: 스포츠/일반
        date_format: '%Y%m%d'
        url_frame: https://sports.daum.net/sports/api/news/list.jsonp?cateIds=1031&pageSize=20&pageNumber={page}&date={date}
        headers:
          Content-Type: application/json

# crawling 과정에서 추출하는 정보
parsing:
  version: v2021-03-17
  parser: html5lib

  # 전체 html 에서 추출해야하는 전체 tag 목록
  trace:
    - parser: json
      column: content

  # 기사 목록에서 추출해야하는 하나의 기사 정보
  list:
    - parser: json
      mapping:
        raw_list: '*'
        url: https://sports.v.daum.net/v/{newsId}

  # 기사 본문에서 추출해야하는 tag 정보
  article:
    - key: raw
      value:
        - name: html
      remove:
        - name: script
        - name: style
        - name: comment
      type: html
    - key: title
      value:
        - select: div.head_view h3.tit_view
      type: text
    - key: date
      replace:
        - from: ^.*입력
          to: ''
        - from: ^.*수정
          to: ''
        - from: 댓글.+$
          to: ''
      value:
        - select: div.head_view span.info_view
      type: text
      convert:
        to: date
        merge: single
    - key: content
      value:
        - select: div.article_view section
      type: text
      convert:
        merge: merge
    - key: '@curl_date'
      value:
        - const: DATE_NOW

# ETL pipeline: raw, raw_list 에서 추출하는 정보
pipeline:
  common:
    - column: raw
      key: source
      value:
        - select: div.head_view img
      type: alt
    - column: raw
      key: author
      replace:
        - from: 입력.+$
          to: ''
      value:
        - select: div.head_view span.info_view
      type: text
        merge: single
    - column: raw
      key: image_list.image
      value:
        - select: div.article_view section img
      type: src
    - column: raw
      delete: true
      key: image_list.caption
      value:
        - select: div.article_view section figcaption
      type: text
    - column: raw
      key: vod
      value:
        - select: div.article_view iframe
      type: html


# 인덱스 맵핑
index_mapping:
  settings:
    number_of_replicas: 1
    number_of_shards: 1
  mappings:
    properties:
      title:
        type: text
      url:
        ignore_above: 256
        type: keyword
      content:
        type: text
      date:
        type: date
      category:
        ignore_above: 50
        type: keyword
      raw:
        enabled: false
      raw_list:
        enabled: false
      parser_version:
        ignore_above: 50
        type: keyword
      status:
        # raw_list, raw, pipeline
        ignore_above: 50
        type: keyword
      '@curl_date':
        type: date
      # pipeline columns
      image_list:
        enabled: false
      vod:
        enabled: false
      source:
        enabled: false
      source_url:
        enabled: false
      source_section:
        enabled: false
      papaer:
        enabled: false
